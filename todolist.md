# 任務清單與進度追蹤

## 專案總覽

本專案旨在提供一個自動化的圖像預處理流程，特別針對動漫風格圖像，以便為 AI 模型訓練做準備。主要功能模組包括：

-   `validate_image.py`: 圖像驗證與損壞檔案移除。
-   `face_detection.py`: 人臉偵測與篩選。
-   `lpips_clustering.py`: LPIPS 相似度去重。
-   `crop.py`: 多規格圖像裁切與分類。
-   `upscale.py`: 圖像超解析度放大。
-   `tag.py`: 自動圖像標記。
-   `gradio_app.py`: Gradio Web UI 介面，提供整合與獨立功能操作。
-   `logger_config.py`: 統一的日誌記錄系統。
-   `error_handler.py`: 統一的錯誤處理機制。
-   `main.py`: 主流程控制腳本 (主要用於命令列操作)。

## 當前待辦事項 / 未來改進

### 高優先級

-   [ ] **Gradio UI - 資料夾瀏覽功能穩定性與體驗**
    -   [ ] 監控並評估 `tkinter.filedialog` 在 Gradio (特別是 Windows 多執行緒環境) 中的長期穩定性。
    -   [ ] 若出現問題，研究替代方案，例如：
        -   [ ] 探索 Gradio 是否有更原生的資料夾選擇元件。
        -   [ ] 提供清晰的指引，讓使用者可以方便地複製貼上路徑。
-   [ ] **效能分析與優化**
    -   [ ] 使用 `cProfile` 或其他分析工具，識別 `lpips_clustering.py`, `upscale.py`, `face_detection.py` 等耗時模組的效能瓶頸。
    -   [ ] 針對瓶頸進行優化：
        -   [ ] 確認 GPU 加速在 LPIPS 和超解析度模型中是否已充分利用。
        -   [ ] 評估是否有更輕量級或執行速度更快的人臉偵測模型選項。
        -   [ ] 優化圖像的讀取和寫入操作，減少 I/O 等待時間。
-   [ ] **使用者文件完善**
    -   [ ] **更新 `README.md`**:
        -   [ ] 提供更詳盡的安裝步驟和 `.env` 檔案配置說明。
        -   [ ] 為 Gradio UI 的每個頁籤和主要功能提供操作指南和截圖。
        -   [ ] 補充各模組的參數說明和預期輸出。
        -   [ ] 增加常見問題解答 (FAQ)，例如關於效能、路徑設定等。
    -   [ ] **`.env.example` 檔案**: 創建或更新 `.env.example`，為每個環境變數提供清晰的註解和範例值。

### 中優先級

-   [ ] **可配置的閾值與進階參數**
    -   [ ] **LPIPS**: 允許在 Gradio UI 中設定相似度閾值 (目前 `process_lpips_clustering` 內部可能使用固定值或未暴露)。
    -   [ ] **人臉偵測**: 如果模型支援，允許設定人臉偵測的信心度閾值。
    -   [ ] **圖像標記**: 在 Gradio UI 中暴露 `tag_threshold` (來自 `tag.py`) 的調整選項。
    -   [ ] **圖像裁切**: 允許更細緻的裁切參數配置 (例如，不同身體部位的比例、填充模式等)。
-   [ ] **擴展模型支援**
    -   [ ] **超解析度**: 研究並整合更多流行的超解析度模型 (如 SwinIR, Real-CUGAN)，並在 UI 中提供選項。
    -   [ ] **圖像標記**: 支援更多標記模型或不同版本的 DeepDanbooru，允許使用者選擇。
-   [ ] **Gradio UI - 增強與細化**
    -   [ ] **輸出結構預覽**: 仔細檢查 `preview_output_structure` 對於所有步驟組合和嵌套輸出情況的準確性。
    -   [ ] **錯誤回饋**: 當特定步驟失敗時，在 UI 上提供更明確、使用者友好的錯誤訊息，而不僅是日誌中的技術細節。
    -   [ ] **批次處理狀態**: 對於整合流程中的每個步驟，如果可能，顯示更詳細的當前處理檔案名或進度。

### 低優先級

-   [ ] **非同步處理/多執行緒優化 (UI 回應性)**
    -   [ ] 評估 Gradio 中長時間執行的後端函式是否可以從目前的同步執行（可能阻塞 UI）改進為非同步執行 (`asyncio`) 或更優化的執行緒管理，以提升 UI 的回應速度。
-   [ ] **進階依賴管理**
    -   [ ] 考慮將 `requirements.txt` 遷移到如 `Poetry` 或 `PDM` 等工具，以實現更可靠的依賴解析、版本鎖定和虛擬環境管理。
-   [ ] **打包成可執行檔**
    -   [ ] 研究使用 `PyInstaller` 或 `Nuitka` 將專案打包，方便沒有 Python 環境的使用者直接執行。
-   [ ] **雲端儲存整合 (Boto3)**
    -   [ ] 實現從 AWS S3 (或其他兼容的雲端儲存服務) 讀取輸入圖像。
    -   [ ] 實現將處理完成的結果寫入到指定的雲端儲存位置。
    -   [ ] 在 Gradio UI 中增加雲端儲存路徑的配置選項和身份驗證管理。
-   [ ] **圖像標記功能擴展**
    -   [ ] 允許使用者提供自訂的標記詞典或標記排除列表。
    -   [ ] 考慮支援對標籤進行編輯或篩選的功能。
-   [ ] **國際化 (i18n) / 本地化 (l10n)**
    -   [ ] 為 Gradio UI 的文字元素和後端產生的日誌/狀態訊息提供多語言支援 (例如，增加英文版本)。

## 已知問題 / 注意事項

-   LPIPS 和超解析度等深度學習模型計算資源消耗較大，處理大量高解析度圖像時可能需要較長時間和較多 VRAM/RAM。
-   `tkinter.filedialog` 在某些 Windows 環境下，當由 Gradio (或其他多執行緒應用) 調用時，可能出現視窗焦點問題或不穩定。
-   專案依賴的外部函式庫 (`waifuc`, `imgutils`, `onnxruntime` 等) 的版本更新可能會引入不兼容的變更或影響現有功能。
-   預設的 Gradio 伺服器是單線程處理請求，高併發使用可能導致請求排隊。

## 版本控制與未來規劃

-   持續使用 Git 進行版本控制，並遵循良好的分支和提交實踐。
-   定期檢視和更新專案依賴項，注意潛在的重大變更。
-   根據使用者回饋、新的技術發展和實際需求，持續迭代和改進專案功能。

---

**最後更新**: {{CURRENT_DATE}}
*由 AI 輔助分析與生成*
